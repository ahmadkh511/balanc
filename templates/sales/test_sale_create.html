<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ¹Ø¯ÙŠÙ„ ÙØ§ØªÙˆØ±Ø© Ø´Ø±Ø§Ø¡</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jQuery UI & CSS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">



  <script>
function calculateTotal(row) {
    const qty = row.querySelector(".quantity").value || 0;
    const price = row.querySelector(".price").value || 0;
    row.querySelector(".total").value = (qty * price).toFixed(2);
    calculateFinal();
  }

  function calculateFinal() {
    let total = 0;
    document.querySelectorAll(".total").forEach(input => {
      total += parseFloat(input.value) || 0;
    });
    const discount = parseFloat(document.getElementById("discount").value) || 0;
    const addition = parseFloat(document.getElementById("addition").value) || 0;
    const tax = parseFloat(document.getElementById("tax").value) || 0;
    const final = total - discount + addition + tax;
    document.getElementById("final_total").value = final.toFixed(2);
  }

  function addRow() {
    const index = document.querySelectorAll(".item-name").length;
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><input type="text" name="item_name[]" class="input item-name" id="item_name_${index}" autocomplete="off"></td>
      <td><input type="number" name="quantity[]" class="input quantity" value="1"></td>
      <td><input type="number" name="price[]" class="input price" value="0"></td>
      <td><input type="text" name="barcode[]" class="input"></td>
      <td><input type="text" name="total[]" class="input total bg-gray-100" readonly></td>
      <td><button type="button" onclick="removeRow(this)">ğŸ—‘ï¸</button></td>
    `;
    document.getElementById("items-body").appendChild(row);
    $(`#item_name_${index}`).autocomplete({ source: "{% url 'autocomplete_product' %}", minLength: 2 });
    row.querySelector(".quantity").addEventListener("input", () => calculateTotal(row));
    row.querySelector(".price").addEventListener("input", () => calculateTotal(row));
  }

  function removeRow(button) {
    button.closest("tr").remove();
    calculateFinal();
  }

  $(function() {
    $("#supplier_name").autocomplete({
      source: "{% url 'autocomplete_customers' %}",
      minLength: 2
    });

    document.querySelectorAll(".item-name").forEach((input, i) => {
      $(`#item_name_${i}`).autocomplete({ source: "{% url 'autocomplete_product' %}", minLength: 2 });
    });

    document.querySelectorAll(".quantity, .price").forEach(input => {
      input.addEventListener("input", () => calculateFinal());
    });

    calculateFinal();
  });
  </script>
  <style>
    .input { @apply w-full p-1 border rounded; }
    th, td { @apply border p-1 text-center; }
  </style>
</head>
<body class="bg-gray-50 p-4 text-sm">
  <div class="max-w-7xl mx-auto bg-white rounded-xl shadow p-6 space-y-6">
    <!-- Ù‚Ø³Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
        <input type="text" class="input bg-gray-100" value="1/05/2025" readonly>
      </div>

      


      <div>
        <label for="supplier_name"  >Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯:</label>
        <input type="text" id="supplier_name" name="supplier_name" value="{{ purchase.supplier.name }}" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯">
      </div>
      <div>
        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
        <input type="text" class="input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
      </div>
      <div>
        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
        <input type="text" class="input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ±Ø¯">
      </div>
      <div>
        <label>Ø§Ù„Ø¹Ù…Ù„Ø©:</label>
        <input type="text" class="input" placeholder="Ø§Ù„Ø¹Ù…Ù„Ø©">
      </div>
      <div>
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
        <input type="text" class="input" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ù†Ù‚Ø¯Ø§Ù‹ / ØªØ­ÙˆÙŠÙ„">
      </div>

      <div>
        <label>Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</label>
        <input type="text" class="input" placeholder="Ù…Ø¯ÙÙˆØ¹Ø© / ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©">
      </div>

      <div>
        <label> Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†:</label>
        <input type="text" class="input" placeholder=" Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù† ">
      </div>

      <div>
        <label> Ø§Ù„Ø¨ÙŠØ§Ù†:</label>
        <input type="text" class="input" placeholder=" Ø§Ù„Ø¨ÙŠØ§Ù† ">
      </div>



    </div>

    <!-- Ù‚Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
    <div>
      <table class="w-full border mt-4 text-sm">
        <thead class="bg-gray-100">
          <tr>
            <th>Ø§Ù„ØµÙ†Ù</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th>Ø§Ù„Ø³Ø¹Ø±</th>
            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
            <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
            <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="items-body"></tbody>
      </table>
      <button onclick="addRow()" class="mt-2 px-3 py-1 bg-blue-500 text-white rounded">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</label>
        <input type="number" id="tax" class="input" oninput="calculateTotals()">
      </div>
      <div>
        <label>Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¹Ø§Ù…:</label>
        <input type="number" id="discount" class="input" oninput="calculateTotals()">
      </div>
      <div>
        <label>Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©:</label>
        <input type="number" id="addition" class="input" oninput="calculateTotals()">
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-100 p-4 rounded">
      <div>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: <span id="subtotal">0.00</span></div>
      <div>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: <span id="tax-val">0.00</span></div>
      <div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: <span id="after-tax">0.00</span></div>
      <div>Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¹Ø§Ù…: <span id="discount-val">0.00</span></div>
      <div>Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©: <span id="addition-val">0.00</span></div>
      <div class="font-bold text-lg">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: <span id="final-total">0.00</span></div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
    <div class="flex justify-end space-x-2 space-x-reverse">
      <button class="bg-green-600 text-white px-4 py-2 rounded">ğŸ’¾ Ø­ÙØ¸</button>
      <button onclick="window.print()" class="bg-blue-600 text-white px-4 py-2 rounded">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      <a href="/invoices" class="bg-gray-400 text-white px-4 py-2 rounded">â†©ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
    </div>
  </div>
</body>
</html>








Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ   Ù…Ø¹ Ø§Ù„Ø§ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ  Ù„Ù„Ø¹Ù…ÙŠÙ„ 


{% extends 'base.html' %}

{% block content %}
  <h1>Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</h1>

  <form method="POST">
    {% csrf_token %}
    {{ form.as_p }}

    <div class="table-responsive">
      <table class="table table-bordered" id="invoice-table">
        <thead>
          <tr>
            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th>Ø§Ù„Ø³Ø¹Ø±</th>
            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
            <th>Ø­Ø°Ù</th>
          </tr>
        </thead>
        <tbody>
          <tr id="item-row-template" style="display: none;">
            <td>
              <input type="text" name="client" class="form-control client-autocomplete" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" />
            </td>
            <td>
              <input type="text" name="item_name" class="form-control item-autocomplete" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" />
            </td>
            <td>
              <input type="number" name="quantity" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" />
            </td>
            <td>
              <input type="number" name="price" class="form-control price" placeholder="Ø§Ù„Ø³Ø¹Ø±" readonly />
            </td>
            <td>
              <input type="number" name="total" class="form-control total" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" readonly />
            </td>
            <td>
              <button type="button" class="btn btn-danger remove-row">Ø­Ø°Ù</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <button type="button" class="btn btn-success" id="add-row">Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯</button>
    <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
  </form>

  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
      const addRowButton = document.getElementById('add-row');
      const tableBody = document.querySelector('#invoice-table tbody');
      const rowTemplate = document.getElementById('item-row-template');

      // Ø¥ØªÙ…Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„
      function autocompleteClient(inputElement) {
        $(inputElement).autocomplete({
          source: '{% url "autocomplete_customers" %}',  // Ù…Ø³Ø§Ø± Ø§Ù„Ù€ URL Ù„Ø·Ù„Ø¨ Ø¥ØªÙ…Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡
          minLength: 2
        });
      }

      // Ø¥ØªÙ…Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø§Ø¯Ø©
      function autocompleteItem(inputElement) {
        $(inputElement).autocomplete({
          source: '{% url "autocomplete_product" %}',  // Ù…Ø³Ø§Ø± Ø§Ù„Ù€ URL Ù„Ø·Ù„Ø¨ Ø¥ØªÙ…Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…ÙˆØ§Ø¯
          minLength: 2
        });
      }

      // Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯
      addRowButton.addEventListener('click', function () {
        const newRow = rowTemplate.cloneNode(true);
        newRow.style.display = 'table-row';
        tableBody.appendChild(newRow);

        // Ø¥ØªÙ…Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø§Ø¯Ø© Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const clientInput = newRow.querySelector('.client-autocomplete');
        const itemInput = newRow.querySelector('.item-autocomplete');
        const quantityInput = newRow.querySelector('[name="quantity"]');
        const priceInput = newRow.querySelector('.price');
        const totalInput = newRow.querySelector('.total');

        autocompleteClient(clientInput);
        autocompleteItem(itemInput);

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ© Ø£Ùˆ Ø§Ù„Ø³Ø¹Ø±
        quantityInput.addEventListener('input', updateTotal);
        priceInput.addEventListener('input', updateTotal);

        function updateTotal() {
          const quantity = parseFloat(quantityInput.value) || 0;
          const price = parseFloat(priceInput.value) || 0;
          totalInput.value = quantity * price;
        }

        // Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø±
        const removeButton = newRow.querySelector('.remove-row');
        removeButton.addEventListener('click', function () {
          newRow.remove();
        });
      });
    });
  </script>

{% endblock %}
