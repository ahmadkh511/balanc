{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-5">
    <h1 class="mb-4 text-center">قائمة الفواتير</h1>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="{% url 'invoice_create' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> إنشاء فاتورة جديدة
        </a>
        <input type="text" id="searchInput" class="form-control w-25" placeholder="بحث...">
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>رقم الفاتورة</th>
                    <th>العميل</th>
                    <th>المجموع الكلي</th>
                    <th>تاريخ الإنشاء</th>
                    <th>طريقة الدفع</th>
                    <th>حالة الفاتورة</th>
                    <th>شركة الشحن</th>
                    <th>رقم الشحنة</th>
                    <th>العملة</th>
                    <th>ملاحظات</th>
                    <th>الصورة</th>
                    <th>الإجراءات</th>
                </tr>
            </thead>
            <tbody>
                {% for invoice in invoices %}
                    <tr>
                        <td>{{ invoice.uniqueId }}</td>
                        <td>{{ invoice.customer.username }}</td>
                        <td>{{ invoice.total_amount }}</td>
                        <td>{{ invoice.date_created|date:"Y-m-d" }}</td>
                        <td>{{ invoice.payment_method }}</td>
                        <td>
                            <span class="badge {% if invoice.status == 'مدفوعة' %}bg-success{% else %}bg-warning{% endif %}">
                                {{ invoice.status|default:"غير مدفوعة" }}
                            </span>
                        </td>
                        <td>{{ invoice.shipping_company }}</td>
                        <td>{{ invoice.shipping_num }}</td>
                        <td>{{ invoice.currency }}</td>
                        <td>{{ invoice.notes|truncatechars:20 }}</td>  <!-- عرض ملاحظات مختصرة -->
                        <td>
                            {% if invoice.items.first.image %}  <!-- عرض الصورة الأولى للفاتورة -->
                                <img src="{{ invoice.items.first.image.url }}" alt="صورة الفاتورة" style="max-width: 50px; height: auto;">
                            {% else %}
                                <span class="text-muted">لا توجد صورة</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'invoice_detail' invoice.pk %}" class="btn btn-info btn-sm" title="عرض">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{% url 'invoice_update' invoice.pk %}" class="btn btn-warning btn-sm" title="تعديل">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="{% url 'invoice_delete' invoice.pk %}" class="btn btn-danger btn-sm" title="حذف">
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="12" class="text-center">لا توجد فواتير لعرضها.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- إضافة مكتبة Font Awesome للأيقونات -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- إضافة مكتبة jQuery للبحث -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // وظيفة البحث
        $("#searchInput").on("keyup", function () {
            const value = $(this).val().toLowerCase();
            $("tbody tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });
    });
</script>
{% endblock %}